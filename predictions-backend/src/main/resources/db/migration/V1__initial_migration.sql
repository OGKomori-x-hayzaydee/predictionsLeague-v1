CREATE SEQUENCE IF NOT EXISTS league_entity_id_seq START WITH 1 INCREMENT BY 1;

CREATE SEQUENCE IF NOT EXISTS otp_entity_id_seq START WITH 1 INCREMENT BY 1;

CREATE SEQUENCE IF NOT EXISTS user_entity_id_seq START WITH 1 INCREMENT BY 1;

CREATE TABLE flyway_schema_history
(
    installed_rank INTEGER                                   NOT NULL,
    version        VARCHAR(50),
    description    VARCHAR(200)                              NOT NULL,
    type           VARCHAR(20)                               NOT NULL,
    script         VARCHAR(1000)                             NOT NULL,
    checksum       INTEGER,
    installed_by   VARCHAR(100)                              NOT NULL,
    installed_on   TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW() NOT NULL,
    execution_time INTEGER                                   NOT NULL,
    success        BOOLEAN                                   NOT NULL,
    CONSTRAINT flyway_schema_history_pk PRIMARY KEY (installed_rank)
);

CREATE TABLE league_entity
(
    id          BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    uuid        VARCHAR(255),
    name        VARCHAR(255),
    league_code VARCHAR(255),
    publicity   VARCHAR(255),
    CONSTRAINT league_entity_pkey PRIMARY KEY (id)
);

CREATE TABLE otp_entity
(
    id         BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    expiration BIGINT,
    user_id    BIGINT,
    value      VARCHAR(255),
    CONSTRAINT otp_entity_pkey PRIMARY KEY (id)
);

CREATE TABLE user_entity
(
    id                 BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    account_verified   BOOLEAN,
    created_at         TIMESTAMP WITHOUT TIME ZONE,
    email              VARCHAR(255),
    password           VARCHAR(255),
    updated_at         TIMESTAMP WITHOUT TIME ZONE,
    userid             VARCHAR(255),
    first_name         VARCHAR(255),
    last_name          VARCHAR(255),
    total_points       INTEGER,
    name               VARCHAR(255),
    resetotp           VARCHAR(255),
    resetotpexpire_at  BIGINT,
    verifyotp          VARCHAR(255),
    verifyotpexpire_at BIGINT,
    CONSTRAINT user_entity_pkey PRIMARY KEY (id)
);

CREATE TABLE user_league_table
(
    league_id BIGINT NOT NULL,
    user_id   BIGINT NOT NULL,
    CONSTRAINT user_league_table_pkey PRIMARY KEY (league_id, user_id)
);

ALTER TABLE user_entity
    ADD CONSTRAINT uk4xad1enskw4j1t2866f7sodrx UNIQUE (email);

CREATE INDEX flyway_schema_history_s_idx ON flyway_schema_history (success);

ALTER TABLE user_league_table
    ADD CONSTRAINT fkdtvyii3o8558mqckuwln1x90k FOREIGN KEY (league_id) REFERENCES league_entity (id) ON DELETE NO ACTION;

ALTER TABLE user_league_table
    ADD CONSTRAINT fkt7kilkwul307lovmbv12icway FOREIGN KEY (user_id) REFERENCES user_entity (id) ON DELETE NO ACTION;