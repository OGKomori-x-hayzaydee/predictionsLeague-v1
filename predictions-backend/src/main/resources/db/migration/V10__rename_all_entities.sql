-- noinspection SqlResolveForFile

ALTER TABLE prediction_entity
    DROP CONSTRAINT fk_prediction_entity_on_user;

ALTER TABLE user_league_table
    DROP CONSTRAINT fkdtvyii3o8558mqckuwln1x90k;

ALTER TABLE user_league_table
    DROP CONSTRAINT fkt7kilkwul307lovmbv12icway;

CREATE TABLE chips
(
    id                 BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    user_id            BIGINT                                  NOT NULL,
    type               VARCHAR(255),
    cooldown_remaining INTEGER,
    last_gameweek_used INTEGER,
    CONSTRAINT pk_chips PRIMARY KEY (id)
);

CREATE TABLE leagues
(
    id          BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    uuid        VARCHAR(255),
    name        VARCHAR(255),
    description VARCHAR(255),
    league_code VARCHAR(255),
    status      VARCHAR(255),
    publicity   VARCHAR(255),
    created_at  TIMESTAMP WITHOUT TIME ZONE,
    CONSTRAINT pk_leagues PRIMARY KEY (id)
);

CREATE TABLE otps
(
    id         BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    user_id    BIGINT,
    value      VARCHAR(255),
    expiration BIGINT,
    CONSTRAINT pk_otps PRIMARY KEY (id)
);

CREATE TABLE predictions
(
    id           BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    user_id      BIGINT,
    match_id     BIGINT,
    home_team    VARCHAR(255),
    away_team    VARCHAR(255),
    home_score   INTEGER,
    away_score   INTEGER,
    home_scorers TEXT[],
    away_scorers TEXT[],
    points       INTEGER,
    correct      BOOLEAN,
    status       VARCHAR(255),
    chips        TEXT[],
    date         TIMESTAMP WITHOUT TIME ZONE,
    gameweek     INTEGER,
    CONSTRAINT pk_predictions PRIMARY KEY (id)
);

CREATE TABLE users
(
    id                  BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    uuid                VARCHAR(255),
    first_name          VARCHAR(255),
    last_name           VARCHAR(255),
    username            VARCHAR(255),
    email               VARCHAR(255),
    password            VARCHAR(255),
    profile_picture_url VARCHAR(255),
    account_verified    BOOLEAN,
    total_points        INTEGER                                 NOT NULL,
    favourite_team      VARCHAR(255),
    created_at          TIMESTAMP WITHOUT TIME ZONE,
    updated_at          TIMESTAMP WITHOUT TIME ZONE,
    CONSTRAINT pk_users PRIMARY KEY (id)
);

ALTER TABLE predictions
    ADD CONSTRAINT uc_predictions_user_match UNIQUE (user_id, match_id);

ALTER TABLE users
    ADD CONSTRAINT uc_users_email UNIQUE (email);

ALTER TABLE chips
    ADD CONSTRAINT FK_CHIPS_ON_USER FOREIGN KEY (user_id) REFERENCES users (id);

ALTER TABLE predictions
    ADD CONSTRAINT FK_PREDICTIONS_ON_USER FOREIGN KEY (user_id) REFERENCES users (id);

ALTER TABLE user_league_table
    ADD CONSTRAINT FK_USER_LEAGUE_TABLE_ON_LEAGUE FOREIGN KEY (league_id) REFERENCES leagues (id);

ALTER TABLE user_league_table
    ADD CONSTRAINT FK_USER_LEAGUE_TABLE_ON_USER FOREIGN KEY (user_id) REFERENCES users (id);

DROP TABLE league_entity CASCADE;

DROP TABLE otp_entity CASCADE;

DROP TABLE prediction_entity CASCADE;

DROP TABLE user_entity CASCADE;

DROP SEQUENCE league_entity_id_seq CASCADE;

DROP SEQUENCE otp_entity_id_seq CASCADE;

DROP SEQUENCE user_entity_id_seq CASCADE;